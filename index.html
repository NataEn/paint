<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
      }
      div {
        margin: 0;
        padding: 0;
        border: 1px solid black;
      }
      .container {
        width: 100vw;
        height: 100vh;
        border: 1px solid black;
        display: flex;
      }
      .canvas {
        position: relative;
        flex: 1;
        border: 2px solid black;
      }
      .colorPicker {
        width: 40px;
        display: flex;
        flex-direction: column;
        border: 2px solid black;
      }
      button {
        width: 30px;
        height: 30px;
        border: 1px solid red;
      }
    </style>
    <title>Document</title>
  </head>
  <body>
    <div class="container">
      <div class="canvas"></div>
      <div class="colorPicker">
        <button class="color" data-color="red"></button>
        <button class="color" data-color="green"></button>
        <button class="color" data-color="blue"></button>
        <button class="color" data-color="black"></button>
        <button class="color" data-color="yellow"></button>
        <button class="erasor" data-color="erasor">E</button>
        <button class="pencile" data-color="pencile">P</button>
      </div>
    </div>
    <script>
      const canvas = document.querySelector(".canvas");
      const colors = document.querySelectorAll(".color");
      const container = document.querySelector(".container");
      let pixels = document.querySelectorAll(".pixel");
      const erasor = document.querySelector(".erasor");
      const pencile = document.querySelector(".pencile");

      let color = "black";
      let pencileState = false;
      let erasorState = false;

      let erasorOn = false;
      let toDraw = false;
      let toErase = false;

      for (let colorB of colors) {
        if (
          colorB.dataset.color != "erasor" &&
          colorB.dataset.color != pencile
        ) {
          colorB.style.background = colorB.dataset.color;
          colorB.addEventListener("click", e => {
            console.log(e.target);
            color = e.target.dataset.color;
          });
        }
      }
      const clearCanvas = () => {
        for (let pixel of pixels) {
          canvas.removeChild(pixel);
        }
      };
      const erasePixel = e => {
        if (erasorState) {
          canvas.removeChild(e.target);
        }
      };
      const eventOnPixel = () => {
        for (let pixel of pixels) {
          pixel.addEventListener("mousemove", erasePixel, true);
        }
      };
      const draw = (x, y) => {
        let pixel = document.createElement("div");
        pixel.style.background = color;
        pixel.style.width = "10px";
        pixel.style.height = "10px";
        pixel.style.border = "1px solid black";
        pixel.style.position = "absolute";
        pixel.style.top = `${y}px`;
        pixel.style.left = `${x}px`;
        pixel.style.zIndex = "2";
        pixel.classList = "pixel";
        canvas.appendChild(pixel);
      };
      const pixelDraw = e => {
        if (pencileState) {
          draw(e.clientX, e.clientY);
        }
      };
      pencile.addEventListener("click", () => {
        console.log("clicked on pencile");
        pencileState = true;
        erasorState = false;
      });
      erasor.addEventListener("click", e => {
        erasorState = true;
        pencileState = false;
        console.log("entered erasor");
        pixels = document.querySelectorAll(".pixel");
      });

      canvas.addEventListener("mousedown", e => {
        console.log("entered mousedown on canvas");
        if (pencileState) {
          console.log("pencil is adding mousemove");
          canvas.addEventListener("mousemove", pixelDraw, true);
          canvas.removeEventListener("mousemove", eventOnPixel, true);
        } else if (erasorState) {
          console.log("erasor is adding mousemove");
          canvas.addEventListener("mousemove", eventOnPixel, true);
          canvas.removeEventListener("mousemove", pixelDraw, true);
        }
      });
      canvas.addEventListener("mouseup", e => {
        console.log("entered mouseup on canvas");
        if (pencileState) {
          console.log("pencil is removing mousemove");
          canvas.removeEventListener("mousemove", pixelDraw, true);
        } else if (erasorState) {
          console.log("erasor is removing mousemove");
          canvas.removeEventListener("mousemove", eventOnPixel, true);
          for (let pixel of pixels) {
            pixel.removeEventListener("mousemove", erasePixel, true);
          }
        }
      });
    </script>
  </body>
</html>
